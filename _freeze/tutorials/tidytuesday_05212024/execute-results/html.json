{
  "hash": "47bcee58f2dd6d8f1aced164645feb45",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Our World in Emissions | TidyTutorial\"\nauthor: \"Mitch Harrison\"\ncategories:\n  - \"Data Viz\"\nimage: \"../../images/thumbnails/projects/tidytuesday/05212024.png\"\n---\n\n\n\n\nWelcome! If you saw my post for this week's TidyTuesday, I'm glad you liked it\nenough to learn from it! If not, you can either scroll to the bottom to see the\nfinal product or click [here](../projects/tidytuesday_05212024/emissions.qmd). \nFor this plot, we will use an area plot to visualize the global\nemissions by type going back to 1900. To start, we will use a bare-bones\n`ggplot2` area chart with no bells or whistles to see what we are working with.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\n# read data and rename an ugly column ------------------------------------------\nemis<- read_csv(paste0(\n  \"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/\",\n  \"data/2024/2024-05-21/emissions.csv\"\n  )\n)\n\nemis <- emis |>\n  rename(emissions = \"total_emissions_MtCO2e\")\n\nemis |>\n  group_by(year, commodity) |>\n  summarise(emissions = sum(emissions), .groups = \"drop\") |>\n  \n  # start of plot --------------------------------------------------------------\n  ggplot(aes(x = year, y = emissions, fill = commodity)) +\n  geom_area(alpha = 0.9)\n```\n\n::: {.cell-output-display}\n![](tidytuesday_05212024_files/figure-html/step-one-1.png){width=672}\n:::\n:::\n\n\n\n\nOkay, we've learned a lot. First, there are a *lot* of categories. A good rule\nof thumb is that once you get to about seven colors, even non-colorblind humans\nstruggle to differentiate. But there is hope! Notice that there are\nseveral types of coal production. Let's aggregate them. Second, there is a long\ntail on the left because of near-zero data. Let's bring our limit to the right\nto get a better look.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemis |>\n  filter(year >= 1900) |> # get rid of that tail\n  mutate(\n    # aggregate coal\n    commodity = if_else(str_detect(commodity, \"Coal\"), \"Coal\", commodity),\n  ) |>\n  group_by(year, commodity) |>\n  summarise(emissions = sum(emissions), .groups = \"drop\") |>\n  \n  # start of plot --------------------------------------------------------------\n  ggplot(aes(x = year, y = emissions, fill = commodity)) +\n  geom_area(alpha = 0.9)\n```\n\n::: {.cell-output-display}\n![](tidytuesday_05212024_files/figure-html/step-two-1.png){width=672}\n:::\n:::\n\n\n\n\nMuch better! But to me, having the smallest category (cement) on top feels \nawkward. Let's reorder the categories! I'll do so in descending order of \nemissions in the last year.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLEVS <- c(\"Coal\", \"Oil & NGL\", \"Natural Gas\", \"Cement\") # our desired order\n\nemis |>\n  filter(year >= 1900) |>\n  mutate(\n    commodity = if_else(str_detect(commodity, \"Coal\"), \"Coal\", commodity),\n    commodity = factor(commodity, levels = LEVS) # re-order \n  ) |>\n  group_by(year, commodity) |>\n  summarise(emissions = sum(emissions), .groups = \"drop\") |>\n  \n  # start of plot --------------------------------------------------------------\n  ggplot(aes(x = year, y = emissions, fill = commodity)) +\n  geom_area(alpha = 0.9)\n```\n\n::: {.cell-output-display}\n![](tidytuesday_05212024_files/figure-html/step-three-1.png){width=672}\n:::\n:::\n\n\n\n\nNow we're cooking! It's time for some style points. I'll use my favorite \naesthetic cheat code: \n[`ggthemes`](https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/). \nLet's add a theme and color scheme. I'm going with the FiveThirtyEight theme and\na colorblind-friendly palette. I'll also take this opportunity to adjust the\nopacity down just a touch. This is a personal choice, but I find it nice to be\nable to see the grid behind such ink-heavy plots as area plots.\n\n::: {.callout-important}\nRemember: unless you are making plots for a very small number of people and you \nknow for certain that none are colorblind, *making inaccessible plots is*\n*inexcusable*. Of course, we all make mistakes, so if you ever notice an \naccessibility issue on my site, reach out and let me know on \n[Discord](https://discord.gg/vF6W2bdKFH) or via a GitHub issue so I can improve \nfor next time!\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLEVS <- c(\"Coal\", \"Oil & NGL\", \"Natural Gas\", \"Cement\") # our desired order\n\nemis |>\n  filter(year >= 1900) |>\n  mutate(\n    commodity = if_else(str_detect(commodity, \"Coal\"), \"Coal\", commodity),\n    commodity = factor(commodity, levels = LEVS) # re-order \n  ) |>\n  group_by(year, commodity) |>\n  summarise(emissions = sum(emissions), .groups = \"drop\") |>\n  \n  # start of plot --------------------------------------------------------------\n  ggplot(aes(x = year, y = emissions, fill = commodity)) +\n  geom_area(alpha = 0.9) + # drop the opacity just a touch\n\n  # add theme and colors (love you, ggthemes) \n  ggthemes::scale_fill_colorblind() +\n  ggthemes::theme_fivethirtyeight()\n```\n\n::: {.cell-output-display}\n![](tidytuesday_05212024_files/figure-html/step-four-1.png){width=672}\n:::\n:::\n\n\n\n\nAnd just like that, it feels like we are almost there! Let's change a few things\nat once. We will change the background color, add the title/subtitle/axis \nlabels/caption, and format the $y$-axis to read `30k` instead of `30000`. That \nwill give us a feel for the final color scheme and how the fonts feel on the \npage. Because of the subscript \"2\" in $CO_2$, I will use the `latex2exp` package \nuse $\\LaTeX$ typesetting in the plot.\n\n::: {.callout-note}\nOne note that is unique to this plot. When we use `theme_fivethirtyeight`, it\nremoves the $y$-axis title. So, although we normally wouldn't have to explicitly\nset the axis title to `element_text` in the `theme` function, we will here. \n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLEVS <- c(\"Coal\", \"Oil & NGL\", \"Natural Gas\", \"Cement\")\nBG_COLOR <- \"#F0F0F0\" # this will be our background color\n\nemis |>\n  filter(year >= 1900) |>\n  mutate(\n    commodity = if_else(str_detect(commodity, \"Coal\"), \"Coal\", commodity),\n    commodity = factor(commodity, levels = LEVS) \n  ) |>\n  group_by(year, commodity) |>\n  summarise(emissions = sum(emissions), .groups = \"drop\") |>\n  \n  # start of plot --------------------------------------------------------------\n  ggplot(aes(x = year, y = emissions, fill = commodity)) +\n  geom_area(alpha = 0.9) +\n\n  ggthemes::scale_fill_colorblind() +\n  ggthemes::theme_fivethirtyeight() +\n\n  # abbreviate the y axis labels using the scales package\n  scale_y_continuous(label = scales::label_number(scale = 1e-3, suffix = \"k\")) +\n\n  # add labels to the plot -----------------------------------------------------\n  labs(\n    x = element_blank(),\n    y = latex2exp::TeX(\"Emissions ($MtCO_2e$)\"), # LaTeX typesetting with TeX()\n    title = \"Our World in Emissions\",\n    subtitle = latex2exp::TeX(\n      paste(\n        \"Emissions are measured in Millions of Tons of $CO_2$ equivalent\",\n        \"($MtCO_2e$)\"\n      )\n    ),\n    caption = paste(\n      \"Made with love by Mitch Harrison\",\n      # long blank line to \"hack\" a an annotation in the bottom-left corner\n      \"                                                                       \",\n      \"Source: Carbon Majors database and TidyTuesday\"\n    )\n  ) +\n  theme(\n    axis.title.y = element_text(size = 10),\n    plot.background = element_rect(fill = BG_COLOR) # change background color\n  ) \n```\n\n::: {.cell-output-display}\n![](tidytuesday_05212024_files/figure-html/step-five-1.png){width=672}\n:::\n:::\n\n\n\n\nYou could submit this plot for public consumption without shame, but we can do \nbetter! For example, I think we could safely remove the legend by annotating the \ncolors directly on the plot. Let's use a `geom_text` to do just that. While this \nentire process has been creative, we are getting into highly subjective \nterritory here. So if you don't like these changes, do something else! I would \nlove to see your ideas.\n\nTo make the annotations, I want the text to be right-justified and directly\natop one another. To accomplish that, I will give `geom_text` a single $x$ value\nbut several $y$ values (one for each category).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLEVS <- c(\"Coal\", \"Oil & NGL\", \"Natural Gas\", \"Cement\")\nBG_COLOR <- \"#F0F0F0\"\n\nemis |>\n  filter(year >= 1900) |>\n  mutate(\n    commodity = if_else(str_detect(commodity, \"Coal\"), \"Coal\", commodity),\n    commodity = factor(commodity, levels = LEVS) \n  ) |>\n  group_by(year, commodity) |>\n  summarise(emissions = sum(emissions), .groups = \"drop\") |>\n  \n  # start of plot --------------------------------------------------------------\n  ggplot(aes(x = year, y = emissions, fill = commodity)) +\n  geom_area(alpha = 0.9) +\n\n  ggthemes::scale_fill_colorblind() +\n  ggthemes::theme_fivethirtyeight() +\n  scale_y_continuous(label = scales::label_number(scale = 1e-3, suffix = \"k\")) +\n\n  # add annotation text to replace the legend ----------------------------------\n  annotate(\n    geom = \"text\",\n    color = \"white\",\n    x = 2020,\n    y = c(1000, 4700, 13000, 26000),\n    label = c(\"Cement\", \"Natural Gas\", \"Oil & NGL\", \"Coal\"),\n    hjust = \"right\",\n    fontface = \"bold\"\n  ) +\n\n  labs(\n    x = element_blank(),\n    y = latex2exp::TeX(\"Emissions ($MtCO_2e$)\"),\n    title = \"Our World in Emissions\",\n    subtitle = latex2exp::TeX(\n      paste(\n        \"Emissions are measured in Millions of Tons of $CO_2$ equivalent\",\n        \"($MtCO_2e$)\"\n      )\n    ),\n    caption = paste(\n      \"Made with love by Mitch Harrison\",\n      \"                                                                       \",\n      \"Source: Carbon Majors database and TidyTuesday\"\n    )\n  ) +\n\n  theme(\n    legend.position = \"none\", # hide the legend\n    axis.title.y = element_text(size = 10),\n    plot.background = element_rect(fill = BG_COLOR)\n  ) \n```\n\n::: {.cell-output-display}\n![](tidytuesday_05212024_files/figure-html/step-six-1.png){width=672}\n:::\n:::\n\n\n\n\nNailed it. Now, I will happily take criticism here. I don't love that the \n\"Cement\" label isn't entirely encompassed by its data. But I think it's much \ncleaner than having a legend drawing our eye away from the plot, so I'll keep \nit.\n\nThe last thing we have to do before we can worry about the big annotation in the \nmiddle of the plot is change where the axes break. That is, set the years and \nemission amount displayed on the x and y axes, respectively. And while I'm at \nit, I will use a `geom_hline` to make the $x$-axis a bit bolder since it melts \ninto the background a little bit too much for my liking.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLEVS <- c(\"Coal\", \"Oil & NGL\", \"Natural Gas\", \"Cement\")\nBG_COLOR <- \"#F0F0F0\"\nGRAY <- \"gray35\"\n\nemis |>\n  filter(year >= 1900) |>\n  mutate(\n    commodity = if_else(str_detect(commodity, \"Coal\"), \"Coal\", commodity),\n    commodity = factor(commodity, levels = LEVS) \n  ) |>\n  group_by(year, commodity) |>\n  summarise(emissions = sum(emissions), .groups = \"drop\") |>\n  \n  # start of plot --------------------------------------------------------------\n  ggplot(aes(x = year, y = emissions, fill = commodity)) +\n  geom_area(alpha = 0.9) +\n\n  ggthemes::scale_fill_colorblind() +\n  ggthemes::theme_fivethirtyeight() +\n\n  # change where the axis breaks occur -----------------------------------------\n  scale_x_continuous(breaks = seq(1900, 2020, 20)) +\n  scale_y_continuous(\n    breaks = seq(0, 40000, 5000), \n    label = scales::label_number(scale = 1e-3, suffix = \"k\")\n  ) +\n\n  annotate(\n    geom = \"text\",\n    color = \"white\",\n    x = 2020,\n    y = c(1000, 4700, 13000, 26000),\n    label = c(\"Cement\", \"Natural Gas\", \"Oil & NGL\", \"Coal\"),\n    hjust = \"right\",\n    fontface = \"bold\"\n  ) +\n\n  labs(\n    x = element_blank(),\n    y = latex2exp::TeX(\"Emissions ($MtCO_2e$)\"),\n    title = \"Our World in Emissions\",\n    subtitle = latex2exp::TeX(\n      paste(\n        \"Emissions are measured in Millions of Tons of $CO_2$ equivalent\",\n        \"($MtCO_2e$)\"\n      )\n    ),\n    caption = paste(\n      \"Made with love by Mitch Harrison\",\n      \"                                                                       \",\n      \"Source: Carbon Majors database and TidyTuesday\"\n    )\n  ) +\n\n  geom_hline(yintercept = 0, linewidth = 0.7, color = GRAY) + # bold axis\n  theme(\n    legend.position = \"none\", # hide the legend\n    axis.title.y = element_text(size = 10),\n    plot.background = element_rect(fill = BG_COLOR)\n  ) \n```\n\n::: {.cell-output-display}\n![](tidytuesday_05212024_files/figure-html/step-seven-1.png){width=672}\n:::\n:::\n\n\n\n\nOnce I write-in the line breaks, I'll use the `annotate` function as before. But \nthat's not all. By default, there is no background with text annotations, so the \ngrid overlaps the text and decreases legibility. To fix this, I'll use \n`annotate` to put a rectangle the same color as the plot background behind the \ntext, which \"removes\" the grid lines behind the text.\n\nFinally, to accomplish the arrow, we will use our final `annotate` to draw a \nline segment and put an arrowhead at the end.\n\n::: {.callout-note}\nNormally, the order that we put things in a `ggplot2` pipeline doesn't matter.\nBut here, if you put the background rectangle after the text annotation, it will\ncover the text, rendering it invisible.\n:::\n\nBecause this is our last edit, I will take this opportunity to make one very \noft-forgotten change: write my alt text. Since you're here, I know you respect \nthe power of data communication. Alt text lets us communicate with those who \nsometimes miss out on learning from plots online. As our color palette did for \ncolorblind viewers, we owe it to our non-sighted friends to let them \nparticipate.\n\nAnd finally, I'll change the aspect ratio of the plot. You may have heard of the \n[golden ratio](https://en.wikipedia.org/wiki/Golden_ratio), which is a ratio \nthat many humans find inherently satisfying to look at. That ratio is \napproximately 1.618:1. The inverse of that number is 0.618, which will be our \nhorizontal aspect ratio (1.618 is vertical). Because the quarto headers won't \nrender with the document, my final header is below:\n```\n#| label: plt-final\n#| fig-width: 8\n#| fig-align: \"center\"\n#| fig-asp: 0.618\n#| fig-alt: |\n#|   This plot is titled Our World in Emissions. It is an area plot that shows\n#|   global emissions over time by type. The types are coal, natural gas,\n#|   cement, and oil and NGL. The plot notes that in 1995, the UN first met to\n#|   discuss the climate threat. The plot shows near-zero emissions from 1900 to\n#|   1920, when a slow increase begins. From there, emission growth seems to be\n#|   exponentially increasing, with no decline since the UN first met. Coal is\n#|   the largest emitter, then oil and NGL, then natural gas, and finally,\n#|   cement.\n```\n\nNow, let's see the plot!\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# constants for ease of code legibility ----------------------------------------\nLEVS <- c(\"Coal\", \"Oil & NGL\", \"Natural Gas\", \"Cement\")\nBG_COLOR <- \"#F0F0F0\"\nUN_TEXT <- paste(\n  \"In 1995, the United Nations\\nConference of the Parties met for\\nthe first\", \n  \"time to discuss the looming\\nthreat of climate change. The COP\\nhas\",\n  \"met twenty-eight times since.\"\n)\n\n# data cleanup -----------------------------------------------------------------\nemis |>\n  filter(year >= 1900) |> # lots of near-zero space without this filter\n  mutate(\n    commodity = if_else(str_detect(commodity, \"Coal\"), \"Coal\", commodity),\n    commodity = factor(commodity, levels = LEVS) # re-order areas\n  ) |>\n  group_by(year, commodity) |>\n  summarise(emissions = sum(emissions), .groups = \"drop\") |>\n  \n  # start of plot --------------------------------------------------------------\n  ggplot(aes(x = year, y = emissions, fill = commodity)) +\n  geom_area(alpha = 0.9) +\n  \n  # UN COP annotation text box -------------------------------------------------\n\n  # the arrow\n  annotate(\n    geom = \"segment\",\n    x = 1995,\n    xend = 1995,\n    y = 35500,\n    yend = 20500,\n    linetype = \"solid\",\n    linejoin = \"round\",\n    linewidth = 1,\n    color = \"grey35\",\n    arrow = arrow(type = \"closed\", length = unit(0.2, \"cm\"))\n  ) +\n\n  # the background rectangle (must be before the text)\n  annotate(\n    geom = \"rect\",\n    xmin = 1945.5,\n    xmax = 1993.5,\n    ymin = 23500,\n    ymax = 35800,\n    fill = BG_COLOR\n  ) +\n\n  # annotation text\n  annotate(\n    geom = \"text\",\n    x = 1992,\n    y = 30000,\n    label = UN_TEXT,\n    color = GRAY,\n    fontface = \"italic\",\n    hjust = \"right\"\n  ) +\n  \n  # replace legend with annotation text ----------------------------------------\n  annotate(\n    geom = \"text\",\n    color = \"white\",\n    x = 2020,\n    y = c(1000, 4700, 13000, 26000),\n    label = c(\"Cement\", \"Natural Gas\", \"Oil & NGL\", \"Coal\"),\n    hjust = \"right\",\n    fontface = \"bold\"\n  ) +\n  \n  # visual style elements (love you, ggthemes) ---------------------------------\n  ggthemes::scale_fill_colorblind() +\n  ggthemes::theme_fivethirtyeight() +\n  \n  # customize axis breaks and labels -------------------------------------------\n  scale_x_continuous(breaks = seq(1900, 2020, 20)) +\n  scale_y_continuous(\n    breaks = seq(0, 40000, 5000), \n    label = scales::label_number(scale = 1e-3, suffix = \"k\")\n  ) +\n  labs(\n    x = element_blank(),\n    y = latex2exp::TeX(\"Emissions ($MtCO_2e$)\"),\n    title = \"Our World in Emissions\",\n    subtitle = latex2exp::TeX(\n      paste(\n        \"Emissions are measured in Millions of Tons of $CO_2$ equivalent\",\n        \"($MtCO_2e$)\"\n      )\n    ),\n    caption = paste(\n      \"Made with love by Mitch Harrison\",\n      \"                                                                       \",\n      \"Source: Carbon Majors database and TidyTuesday\"\n    )\n  ) + \n  \n  # theme cleanup --------------------------------------------------------------\n  geom_hline(yintercept = 0, linewidth = 0.7, color = GRAY) + # bold axis\n  theme(\n    legend.position = \"none\", \n    axis.title.y = element_text(size = 10),\n    plot.background = element_rect(fill = BG_COLOR)\n  ) \n```\n\n::: {.cell-output-display}\n![](tidytuesday_05212024_files/figure-html/plt-final-1.png){fig-align='center' fig-alt='This plot is titled Our World in Emissions. It is an area plot that shows\nglobal emissions over time by type. The types are coal, natural gas,\ncement, and oil and NGL. The plot notes that in 1995, the UN first met to\ndiscuss the climate threat. The plot shows near-zero emissions from 1900 to\n1920, when a slow increase begins. From there, emission growth seems to be\nexponentially increasing, with no decline since the UN first met. Coal is\nthe largest emitter, then oil and NGL, then natural gas, and finally,\ncement.' width=768}\n:::\n:::\n\n\n\n\nNo plot is perfect, but I am happy with what we have accomplished, and I hope \nyou are too! If you have any questions or corrections, feel free to reach out on \n[Discord](https://discord.gg/vF6W2bdKFH), and I'll be happy to help. And, of \ncourse, if you want to contribute to this effort financially, you are more than \nwelcome to [buy me a coffee](https://buymeacoffee.com/mitchellharrison).\n\nThanks for sticking around, and good luck with your TidyTuesday adventures!",
    "supporting": [
      "tidytuesday_05212024_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}